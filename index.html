<html>

<head>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>
</head>

<body>
  <a-scene mindar-image="imageTargetSrc: targets.mind;" color-space="sRGB"
    renderer="colorManagement: true, physicallyCorrectLights" vr-mode-ui="enabled: false"
    device-orientation-permission-ui="enabled: false">

    <a-assets timeout="60000">
      <!-- è¡¨ç¤ºã•ã›ãŸã„ç”»åƒã®åå‰ã‚’src=" ã“ã“ "ã«å…¥ã‚Œã‚‹-->
      <!-- <img id="image" src="meisei.jpg" /> -->

      <!-- è¡¨ç¤ºã•ã›ãŸã„å‹•ç”»ã®åå‰ã‚’src=" ã“ã“ "ã«å…¥ã‚Œã‚‹-->
      <video id="video" src="videoplayback.mp4" loop muted playsinline 
        webkit-playsinline preload="metadata" crossorigin="anonymous"></video>
    </a-assets>

    <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>
    <a-entity id="marker" mindar-image-target="targetIndex: 0">
      <!-- ç”»åƒã‚’è¡¨ç¤ºã•ã›ãŸã„å ´åˆã¯ã“ã“ã‚’ç·¨é›† -->
      <!-- <a-plane src="#image" position="0 0 0" height="0.552" width="1"></a-plane> -->
      <!-- å‹•ç”»ã‚’è¡¨ç¤ºã•ã›ãŸã„å ´åˆã¯ã“ã“ã‚’ç·¨é›† -->
      <a-video id="arVideo" src="#video" position="0 0 0" width="1.7" height="0.956" visible="false"></a-video>
    </a-entity>

  </a-scene>

  <button id="enableSound" style="position:fixed;z-index:9999;top:10px;left:10px;">
    ğŸ”Š éŸ³å£°ã‚’æœ‰åŠ¹ã«ã™ã‚‹
  </button>
  <script>
    const btn = document.getElementById('enableSound');
    btn.addEventListener('click', async () => {
      try {
        // ä¸€åº¦ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œå†…ã§å†ç”Ÿâ†’åœæ­¢â†’ã‚¢ãƒ³ãƒŸãƒ¥ãƒ¼ãƒˆ
        video.muted = true;
        await video.play();
        video.pause();
        video.currentTime = 0;
        video.muted = false;
        btn.remove(); // ä»¥å¾Œã¯ targetFound ã§éŸ³ã‚ã‚Šå†ç”ŸOK
      } catch (e) {
        console.warn('enable sound failed', e);
      }
    }, {once: true});
  </script>


  <script>
    const video = document.getElementById('video');
    const arVideo = document.getElementById('arVideo');
    const marker = document.getElementById('marker');

    // å¿µã®ãŸã‚åˆæœŸåœæ­¢
    video.pause(); video.currentTime = 0;

    marker.addEventListener('targetFound', async () => {
      // æ¤œå‡ºã—ãŸã‚‰è¡¨ç¤ºã—ã¦è‡ªå‹•å†ç”Ÿï¼ˆmuted ãªã®ã§å„ãƒ–ãƒ©ã‚¦ã‚¶ã§é€šã‚‹ï¼‰
      arVideo.setAttribute('visible', true);
      try {
        // å…ˆã«1ãƒ•ãƒ¬ãƒ¼ãƒ åˆ†ãƒ­ãƒ¼ãƒ‰ã—ã¦ã‹ã‚‰å†ç”Ÿã™ã‚‹ã¨å®‰å®š
        if (video.readyState < 2) video.load();
        await video.play();
      } catch (e) {console.warn('auto play failed', e);}
    });

    marker.addEventListener('targetLost', () => {
      // ãƒ­ã‚¹ãƒˆã—ãŸã‚‰åœæ­¢ï¼†éè¡¨ç¤º
      video.pause();
      // æˆ»ã—ãŸã„å ´åˆã¯ 0 ã«
      // video.currentTime = 0;
      arVideo.setAttribute('visible', false);
    });
  </script>
</body>

</html>